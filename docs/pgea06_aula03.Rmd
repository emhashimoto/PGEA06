---
title: "PGEA06 - Estatística Aplicada"
subtitle: "Análise de regressão"
author: "Elizabeth Mie Hashimoto <br> DAMAT-LD"
output:
  xaringan::moon_reader:
    css: [metropolis, metropolis-fonts, tema_pgea06.css]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: false
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, 
                      comment = '',
                      message = FALSE,
                      warning = FALSE)
```
<style> 
#caixa {
  border: 1px solid;
  padding: 10px;
  box-shadow: 5px 10px blue;
}
div {
  text-align: justify;
  text-justify: inter-word;
}
</style>

<style type="text/css">
.remark-slide-content {
    font-size: 30px;
}
</style>

# Modelo de regressão

```{r , echo=FALSE, fig.align = 'center', out.width = '70%'}
knitr::include_graphics('https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNmlqY3J1bTc0Nnc3ZmRsdWQxNTdoejluMWp1b2Y0dXIwYnUwM2UxYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/RCtKcMeeIlIFskmH7C/giphy.gif')
```

--

- **Variáveis** associada à um fenômeno

--

- Fazer uma **representação matemática**

<center><small>variável resposta = variáveis explicativas + termo aleatório </small></center>

---

# Modelo de regressão

&#127919; Estudar a **associação** entre duas ou mais variáveis.


```{r, out.width="50%",fig.align='center'}
df <- mtcars
m <- lm(mpg~wt, data=df)
yhat <- m$coefficients[[1]]+(m$coefficients[[2]]*df$wt)

library(ggplot2)
df |> 
  dplyr::mutate(yhat) |> 
  ggplot() +
  aes(x = wt, y = mpg) +
  geom_point(size = 8) +
  labs(x = 'Valores de x', 
       y = 'Valores y') +
  theme(axis.title = element_text(size=30),
        axis.text = element_text(size=30))
```

---

# Correlação

- Quantificar o grau de relação entre duas variáveis.

--

- Correlação de Pearson

Dado um conjunto de dados $\{(x_1,y_1),\ldots,(x_n,y_n)\}$ consistindo de $n$ pares, o coeficiente de correlação de Pearson é dado por

$$r=\frac{\sum\limits_{i=1}^{n}x_iy_i-n\bar{x}\bar{y}}{\sqrt{\sum\limits_{i=1}^{n}x_i^2-n\bar{x}^2}\sqrt{\sum\limits_{i=1}^{n}y_i^2-n\bar{y}^2}}$$

---

```{r}
rho <- c('0,00 a 0,19', '0,20 a 0,39',
         '0,40 a 0,69', '0,70 a 0,89',
         '0,90 a 1,00')
interp <- c('Correlação bem fraca',
            'Correlação fraca',
            'Correlação moderada',
            'Correlação forte',
            'Correlação muito forte') 
df <- data.frame(rho,interp)

df |> 
  kableExtra::kbl(col.names = c('r','Interpretação'),
                  align = c('c')) |> 
  kableExtra::kable_classic(full_width = F, html_font = "Cambria") |> 
  kableExtra::footnote(general = "http://leg.ufpr.br/~silvia/CE003/node74.html ")
```

---

# Cuidado com a interpretação

```{r , echo=FALSE, fig.align = 'left', out.width = '25%'}
knitr::include_graphics('https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExZTYzajA1dzk2bzdmMW55eXZtNXRpbHlzYzl4M2EwcDZpbmJncTE5OCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3ov9k9Ss9N3wO6FQ7C/giphy.gif')
```

.pull-left[
"A venda de sorte é fortemente correlacionada com o número de afogamentos."
]
.pull-right[
```{r , echo=FALSE, fig.align = 'center', out.width = '90%'}
knitr::include_graphics('figuras/espuria.jpg')
```
]

---

# Explicação

```{r , echo=FALSE, fig.align = 'center', out.width = '100%'}
knitr::include_graphics('figuras/cor_vs_casual.png')
```
<center><small>https://estatisticafacil.org/correlacao-vs-causalidade/</small></center>

---

# Modelo de regressão linear simples

- **Uma** variável explicativa 

```{r, out.width="50%",fig.align='center', fig.cap='Gráfico de dispersão'}
df <- mtcars
m <- lm(mpg~wt, data=df)
yhat <- m$coefficients[[1]]+(m$coefficients[[2]]*df$wt)

library(ggplot2)
df |> 
  dplyr::mutate(yhat) |> 
  ggplot() +
  aes(x = wt, y = mpg) +
  geom_point(size = 8) +
  labs(x = 'Valores de x', 
       y = 'Valores y') +
  theme(axis.title = element_text(size=30),
        axis.text = element_text(size=30))
```

---

# Modelo de regressão linear múltipa

- **Duas** variáveis explicativas  

```{r}
mm <- lm(mpg~+disp+wt, data=df)
ymhat <- mm$coefficients[[1]]+
  (mm$coefficients[[2]]*df$disp)+
  (mm$coefficients[[3]]*df$wt)

library(plotly)
df_novo <- df |> 
  dplyr::mutate(ymhat)

p <- plot_ly(
  df_novo, 
  x = ~wt, y = ~mpg, z = ~disp) |> 
  add_markers() |> 
  layout(
    scene = list(xaxis = list(title = 'Valores de x1'),
        yaxis = list(title = 'Valores de y'),
        zaxis = list(title = 'Valores de x2'))
        )

htmltools::tagList(p)
```

---

# Adequação do modelo

<center>variável resposta = variáveis explicativas + termo aleatório </center>

--

Usando **notação matemática**:

$$y=\beta_0+\beta_1x_1+\ldots\beta_px_p+\varepsilon$$
em que o erro aleatório satisfaz as seguintes características:

---

# Roteiro da análise de regressão

.pull-left[
]
.pull-right[
```{r , echo=FALSE, fig.align = 'center', out.width = '75%'}
knitr::include_graphics('https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExMmZvYXZieWxqZnVrMmJucDlvNTF5ZjR4bjN2dHAwcmwyeDN3czI1YiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HZrx8kjIA7lyeTqXVM/giphy.gif')
```
]

- Fazer um gráfico de dispersão (para duas variáveis);

--

- Determinar a correlação entre as variáveis;

--

- Estimar o modelo de regressão linear;

--

- Análise de resíduo;

--

- Fazer as inferências.

---

# Exemplo

Pesquisadores de um laboratório de Ciências Ambientais estão interessados em compreender quais fatores influenciam a taxa de decomposição da matéria orgânica do solo.

A decomposição da matéria orgânica depende de uma série de fatores ambientais, entre eles a umidade do solo, a quantidade de luz solar recebida e a disponibilidade de nutrientes. 

Para investigar essas relações, os pesquisadores coletaram amostras de solo em 150 parcelas experimentais distribuídas em uma área de estudo. Em cada parcela, foram medidas as seguintes variáveis:

---

- Variável resposta ($Y$): **decomp_rate** - taxa de decomposição da matéria orgânica (g/dia)

- $x_1$: **soil_moisture** - Umidade do solo (%)

- $x_2$: **sunlight_hours**	- horas de luz solar diária	(h/dia)

- $x_3$: **nutrient_mgkg** - concentração de nutrientes no solo	(mg/kg)

O objetivo é ajustar um modelo de regressão linear múltipla para investigar de que forma as variáveis ambientais influenciam a taxa de decomposição da matéria orgânica.

---

# Análise de regressão

✅ 1. As variáveis são correlacionadas?

✅ 2. O que os resultados da análise dos resíduos revelam sobre a adequação do modelo de regressão ajustado?

✅ 3. Qual o modelo estimado?

✅ 4. De que forma as variáveis explicativas influenciam a taxa de decomposição da matéria orgânica?

✅ 5. Quais condições favorecem uma maior taxa de decomposição?

✅ 6. Como esse resultado pode auxiliar na compreensão da dinâmica do solo e no manejo sustentável?

---

# Próxima aula

.pull-left[

&#10004; Leitura Capítulo 6

- Subcapítulos 6.3 e 6.4
]

.pull-right[
```{r,echo=FALSE, fig.align='center', out.width='65%'}
knitr::include_graphics('figuras/mont7.png')
```
]

---

# Atividade - Aula3

Pesquisadores do curso de Engenharia Ambiental estão conduzindo um estudo para compreender quais fatores ambientais afetam o índice de qualidade da água (IQA) em um reservatório que abastece uma cidade de médio porte.
O IQA varia de 0 a 100, e valores mais altos indicam melhor qualidade da água.

Em 120 pontos de coleta distribuídos ao longo do reservatório, foram medidas as seguintes variáveis:

- Variável resposta ($Y$): **IQA** - índice de qualidade da água

- $x_1$: **temperature** - temperatura da água (oC)

- $x_2$: **ph_level**	- pH da água

---

- $x_3$: **turbidity** - turbidez	(NTU)

- $x_4$: **nitrate_mgl** - concentração de nitrato	(mg/L)

---

Os pesquisadores suspeitam que aumento da temperatura e da turbidez reduzem a qualidade da água, enquanto níveis moderados de pH e baixas concentrações de nitrato contribuem para melhores índices de IQA.

Nesse contexto, faça uma análise de regressão. As questõe do exemplo podem ser utilizadas para ajudar na construção da análise.
